"use strict";(self["webpackChunknina_webapp"]=self["webpackChunknina_webapp"]||[]).push([[838],{4838:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}});t(4603),t(7566),t(8721);var n=t(6768),i=t(4232),o=t(144),r=t(3609),l=t(5430),c=t(1695),u=t(133);const s={key:0,class:"flex items-center justify-center min-h-screen"},f={key:1},g=["src"];var h={__name:"FramingAssitantImg",setup(e){const a=(0,l.z)(),t=(0,c.C)(),h=(0,o.KR)(!0),v=(0,o.KR)(null),d=(0,o.KR)(.004),m=a.RAangle,b=a.DECangle,R=(0,o.KR)(0),S=(0,o.KR)(0),p=(0,o.KR)(null),w=(0,o.KR)(null),z=(0,o.KR)(null);let A;function k(){clearTimeout(A),A=setTimeout((()=>{y()}),500)}function y(){const e=a.rotationAngle%360;z.value.request("rotatable",{rotate:e},!0)}function M(e){const t=a.framingInfo.CameraWidth,n=a.framingInfo.CameraHeight,i=a.framingInfo.CameraPixelSize/1e6,o=a.framingInfo.FocalLength/1e3;d.value=e/a.containerSize;const r=t*i,l=n*i,c=2*H(Math.atan(r/2/o)),u=2*H(Math.atan(l/2/o)),s=c/d.value,f=u/d.value;a.camWidth=s,a.camHeight=f}function $(){let e=a.fov;M(e),console.log("setMinTargetFov ",e);while(a.camWidth+200>a.containerSize)if(e+=1,M(e),console.log("fov hochgesetzt:",a.fov),e>50){console.warn("Fov zu hoch, Abbruch!");break}a.fov=e}function C(e){R.value+=e.delta[0],S.value+=e.delta[1],R.value<0&&(R.value=0),S.value<0&&(S.value=0),R.value>a.containerSize-a.camWidth&&(R.value=a.containerSize-a.camWidth),S.value>a.containerSize-a.camHeight&&(S.value=a.containerSize-a.camHeight),F()}async function x(){try{const e=a.RAangle,n=a.DECangle,i=a.containerSize,o=a.containerSize,r=a.fov,l=t.framing.useNinaCache;M(a.fov),v.value&&URL.revokeObjectURL(v.value),v.value=await u.A.searchTargetPic(i,o,r,e,n,l)}catch(e){console.error("Fehler beim Abrufen des Bildes:",e)}}async function I(){try{const e=await u.A.framingAction("info");a.framingInfo=e.Response}catch(e){console.error("Fehler beim Abrufen des FramingInfo:",e)}}function F(){const e=R.value+a.camWidth/2,t=S.value+a.camHeight/2,n=a.containerSize/2,i=e-n,o=n-t,r=o*d.value;let l=Math.cos(b*Math.PI/180);Math.abs(l)<1e-8&&(l=1e-8);const c=i*d.value/l,u=m-c,s=b+r;a.RAangleString=W(u),a.DECangleString=_(s),a.RAangle=u,a.DECangle=s}function W(e){const a=e/15,t=Math.floor(a),n=a-t,i=60*n,o=Math.floor(i),r=i-o,l=60*r,c=String(t),u=String(o).padStart(2,"0"),s=l.toFixed(1).padStart(4,"0");return`${c}:${u}:${s}`}function _(e){const a=e<0?"-":"+";e=Math.abs(e);const t=Math.floor(e),n=e-t,i=60*n,o=Math.floor(i),r=i-o,l=60*r,c=String(t).padStart(2,"0"),u=String(o).padStart(2,"0"),s=l.toFixed(1).padStart(4,"0");return`${a}${c}:${u}:${s}`}function H(e){return e*(180/Math.PI)}return(0,n.sV)((async()=>{await I();const e=Math.min(window.innerWidth,window.innerHeight-200),t=100*Math.floor(e/100);a.containerSize=t,$(),await x(),R.value=a.containerSize/2-a.camWidth/2,S.value=a.containerSize/2-a.camHeight/2,await(0,n.dY)(),await new Promise((e=>setTimeout(e,500))),h.value=!1})),(0,n.wB)((()=>a.rotationAngle),(()=>{console.log("debounceRotateRange:",a.rotationAngle),k()})),(e,t)=>h.value?((0,n.uX)(),(0,n.CE)("div",s,t[0]||(t[0]=[(0,n.Lk)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"},null,-1)]))):((0,n.uX)(),(0,n.CE)("div",f,[(0,n.Lk)("div",{id:"fov",class:"border relative overflow-hidden",style:(0,i.Tr)({width:`${(0,o.R1)(a).containerSize}px`,height:`${(0,o.R1)(a).containerSize}px`,position:"relative"}),ref_key:"containerRef",ref:p},[(0,n.Lk)("img",{class:"absolute inset-0",src:v.value},null,8,g),(0,n.Lk)("div",{class:"target",ref_key:"targetRef",ref:w,style:(0,i.Tr)({width:`${(0,o.R1)(a).camWidth}px`,height:`${(0,o.R1)(a).camHeight}px`,transform:`translate(${R.value}px, ${S.value}px) rotate(${-(0,o.R1)(a).rotationAngle}deg)`,zIndex:2})},null,4),(0,n.bF)((0,o.R1)(r.Ay),{ref_key:"moveableRef",ref:z,target:w.value,draggable:!0,rotatable:!1,onDrag:C},null,8,["target"])],4)]))}},v=t(1241);const d=(0,v.A)(h,[["__scopeId","data-v-1ac87e28"]]);var m=d}}]);
//# sourceMappingURL=838.ce7b3420.js.map